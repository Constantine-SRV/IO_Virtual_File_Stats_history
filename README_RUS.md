
# Мониторинг производительности ввода/вывода SQL Server

## Обзор

Этот проект предназначен для мониторинга производительности дискового ввода/вывода SQL Server на уровне файлов и предоставляет детализированную статистику по операциям чтения/записи и задержке. Данные собираются каждую минуту с использованием функции `sys.dm_io_virtual_file_stats` и сохраняются в специальной таблице. Затем данные обрабатываются с помощью SQL-запросов для предоставления информации о производительности дисков, включая задержку, пропускную способность и общий объем прочитанных/записанных данных за минуту.

## Особенности

- **Мониторинг ввода/вывода в реальном времени**: Сбор и хранение данных о производительности ввода/вывода SQL Server каждую минуту, включая чтения, записи и задержки.
- **Хранение исторических данных**: Сохранение собранных данных в специальной таблице для длительного анализа и сравнения.
- **Подробные метрики производительности**: Расчет задержки чтения и записи, пропускной способности (МБ/с) и среднего объема данных за операцию на основе последних данных.
- **Группировка по файлам и дискам**: Предоставление агрегированной статистики как для отдельных файлов баз данных, так и для дисков в целом.
- **Автоматическая очистка данных**: Логика для периодического удаления старых данных, чтобы предотвратить чрезмерный рост таблицы.
- **Поддержка нескольких дисков**: Группировка данных по первой букве пути к файлу для анализа производительности на уровне дисков.

## Ключевые запросы

### 1. **Запрос производительности на уровне дисков**
Этот запрос предоставляет общий обзор производительности, с фокусом на метрики уровня дисков, такие как пропускная способность чтения/записи, общий объем данных и задержка на диске. Полезно для выявления общей нагрузки на диски и возможных узких мест.

- [Запрос уровня дисков: Группировка по дискам](https://github.com/Constantine-SRV/IO_Virtual_File_Stats_history/blob/main/selectGroupByDisk.sql)

### 2. **Запрос производительности на уровне файлов**
Для более детализированного анализа используйте этот запрос для получения метрик производительности на уровне отдельных файлов. Он предоставляет информацию о задержке, пропускной способности и объеме переданных данных для каждого файла на сервере.

- [Запрос уровня файлов: Статистика для каждого файла](https://github.com/Constantine-SRV/IO_Virtual_File_Stats_history/blob/main/SelectForEachFile.sql)

## Инструкция

1. **Шаг 1: Создание таблицы для сбора данных**
   Создайте таблицу для хранения статистики ввода/вывода:
   - [Скрипт создания таблицы](https://github.com/Constantine-SRV/IO_Virtual_File_Stats_history/blob/main/tbl_IO_Virtual_File_Stats.sql)

2. **Шаг 2: Настройка сбора данных**
   Настройте задание (например, SQL Server Agent), чтобы выполнять скрипт сбора данных каждую минуту:
   - [Скрипт сбора данных](https://github.com/Constantine-SRV/IO_Virtual_File_Stats_history/blob/main/loop.sql)

3. **Шаг 3: Анализ производительности ввода/вывода на дисках**
   Начните с использования **Запроса производительности на уровне дисков**, чтобы понять нагрузку и задержки на каждом диске. Это даст вам общий обзор производительности каждого диска с точки зрения пропускной способности и задержки:
   - [Запрос группировки по дискам](https://github.com/Constantine-SRV/IO_Virtual_File_Stats_history/blob/main/selectGroupByDisk.sql)

4. **Шаг 4: Детализированный анализ на уровне файлов**
   Если вам нужны более детализированные данные для конкретных файлов, выполните **Запрос производительности на уровне файлов**. Этот запрос предоставляет детализированную информацию о производительности ввода/вывода для каждого файла, помогая выявить проблемы на уровне файлов:
   - [Запрос уровня файлов](https://github.com/Constantine-SRV/IO_Virtual_File_Stats_history/blob/main/SelectForEachFile.sql)

## Примеры использования

- **Мониторинг производительности баз данных**: Используйте этот проект для выявления узких мест в производительности дисков ввода/вывода, что поможет оптимизировать работу SQL Server.
- **Анализ исторических данных о производительности**: Отслеживайте тренды производительности с течением времени, сохраняя исторические данные и просматривая предыдущие результаты.
- **Оптимизация дисков**: Анализируйте производительность по дискам, чтобы выявить недостаточно эффективные диски, которые могут требовать обновления или перенастройки.
